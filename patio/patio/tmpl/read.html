<!doctype html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<link href="!bbs_css!" rel="stylesheet">
	<script src="!bbs_js!"></script>
	<title>記事閲覧</title>
</head>

<body>
	<script>
		// miniモード判定
		if (window.location.search.includes('view=mini')) {
			document.body.classList.add('mini-mode');
		}
	</script>

	<header id="head">
		<div class="main-ttl">
			<h1>!bbs_title!</h1>
		</div>
	</header>

	<main class="main">

		<div class="bbs-navi" style="display:flex; justify-content:space-between; align-items:center;">
			<div>
				<a href="!bbs_cgi!">↩ 一覧に戻る</a> |
				<a href="#resform" onclick="document.bbsform.comment.focus();" title="返信フォームへ移動">✉ 返信する</a> |
				<a href="!bbs_cgi!?mode=manual">📖 使い方</a> |
				<a href="!bbs_cgi!?mode=archive&no=!res!" title="このスレッドをZIPで保存" target="_blank">📦 思い出を保存</a>
				<!-- past -->
				&gt; <a href="!bbs_cgi!?mode=past">過去ログ</a>
				<!-- /past -->
				&gt; 記事閲覧
			</div>
			<a href="#resform" class="jump-btn">▼ 最下部（投稿欄）へ移動</a>
		</div>

		<!-- Main Thread Post -->
		<article class="post starter">
			<div class="art-head">
				!ico! !sub!
			</div>

			<div class="art-meta">
				<div><b>投稿者</b>： !name!</div>
				<div><b>投稿日</b>： !date!</div>
				<!-- id -->
				<div><b>ID</b>： !id!</div>
				<!-- /id -->
				<div><b>URL</b>： !url!</div>
			</div>

			<div class="comment">
				!comment!
			</div>

			<!-- edit -->
			<div class="edit-link">
				!ico_edit!
			</div>
			<!-- /edit -->
		</article>

		!page_btn!

		<!-- Replies Loop -->
		<section class="replies">
			<!-- loop -->
			<article class="post reply">
				<div class="res-sub">!res_sub!</div>
				<div class="art-meta-flex">
					<div class="res-author"><b>!res_name!</b> <span style="font-size:0.8rem;">(!res_date!)</span></div>
					<div class="reply-actions">
						<a href="javascript:void(0)" onclick="addToDesk('!res_name!', this)" class="btn-desk">📥
							デスクに置く</a>
						<a href="javascript:void(0)" onclick="openFloatingForm('!res_name!')"
							class="btn-floating-open">直接返信 ✉</a>
					</div>
				</div>

				<!-- デスク用入力エリア（初期非表示） -->
				<div class="desk-input-area" style="display:none;">
					<!-- タイムラインエリア -->
					<div class="desk-timeline" style="display:none;">
						<!-- ここに会話ログが注入されます -->
					</div>

					<div class="desk-field">
						<label>件名</label>
						<input type="text" class="desk-subject" placeholder="お返事のタイトル">
					</div>
					<div class="desk-field">
						<label>あなたの名前</label>
						<input type="text" class="desk-name" placeholder="投稿者名">
					</div>
					<div class="desk-field">
						<label>パスワード</label>
						<input type="password" class="desk-pwd" placeholder="編集・削除用パスワード">
					</div>
					<div class="desk-field">
						<label>メッセージ</label>
						<textarea placeholder="!res_name! さんへのお返事をここに..." rows="4" class="desk-textarea"></textarea>
					</div>
					<div class="desk-actions">
						<button onclick="saveToDeskStorage('!res_name!', this)" class="btn-save-desk">保存してデスクへ</button>
						<button onclick="closeDeskInput(this)" class="btn-cancel-desk">キャンセル</button>
					</div>
				</div>

				<div class="comment">
					!res_com!
				</div>

				<!-- edit -->
				<div class="edit-link">
					!res_ico_edit!
				</div>
				<!-- /edit -->
			</article>
			<!-- /loop -->
		</section>

		!page_btn!

		<!-- Reply Form -->
		<!-- resform -->
		<div id="resform" class="form-container mt-3">
			<h3 class="topic-header mb-1" style="text-align:left; font-size:1.2rem;">✉ 書き込み画面</h3>

			<form action="!regist_cgi!" method="post" name="bbsform" enctype="multipart/form-data">
				<input type="hidden" name="mode" value="regist">
				<input type="hidden" name="res" value="!res!">

				<div class="bbsform">
					<div class="form-group">
						<label>件名</label>
						<input type="text" name="sub" value="!fm_sub!">
						<input type="hidden" name="sort" value="1">
					</div>

					<div class="form-group">
						<label>名前</label>
						<input type="text" name="name" value="!fm_name!">
					</div>


					<div class="form-group">
						<label>メッセージ</label>
						<textarea name="comment" rows="7"></textarea>
					</div>

					<div class="form-group">
						<label>画像添付</label>
						<div class="file-input-wrapper">
							<input type="file" name="upfile1">
						</div>
						<div class="file-input-wrapper">
							<input type="file" name="upfile2">
						</div>
						<div class="file-input-wrapper">
							<input type="file" name="upfile3">
						</div>
					</div>

					<div class="form-group">
						<label>削除パスワード</label>
						<input type="password" name="pwd">
					</div>
				</div>

				<div class="submit-btn-area">
					<input type="submit" value="送信" class="submit-btn">
				</div>
			</form>
		</div>
		<!-- /resform -->

	</main>

	<!-- 文通デスクパネル -->
	<div id="correspondeskPanel" class="correspondesk-panel">
		<div class="desk-header">
			<h3>✉️ 文通デスク</h3>
			<div class="desk-header-actions">
				<button onclick="sendAllDeskItems()" class="btn-send-all">🚀 一括送信</button>
				<button onclick="clearAllDeskItems()" class="btn-clear-all">全てクリア</button>
				<button onclick="toggleDeskPanel()" class="btn-toggle-desk">▼</button>
			</div>
		</div>
		<div class="desk-content">
			<div id="deskItemList" class="desk-item-list">
				<!-- JavaScriptで動的に追加 -->
			</div>
			<p class="desk-empty-msg" id="deskEmptyMsg">お返事がストックされていません。</p>
		</div>
	</div>

</body>

</html>