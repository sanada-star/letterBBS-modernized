# LetterBBS

## 概要
**LetterBBS** は、KENT WEB様で公開されている「Patio」をベースに、PBC（Play by Chat）やPBW（Play by Web）などの「キャラクター交流」向けに大幅な改造を施したCGIスクリプトです。

往復書簡形式のロールプレイ、1対1のロールプレイ上の秘匿会話、そしてログの保存に特化しています。

## 📑 目次
1. [概要](#概要)
2. [配布・利用規定](#%EF%B8%8F-配布利用規定-distribution--license)
3. [主な機能](#主な機能-v30)
4. [ダウンロード方法](#-ダウンロード方法-download)
5. [設置方法 (簡易)](#設置方法-installation)
6. [プログラムの設定及び設置 (詳細)](#プログラムの設定及び設置)
7. [トラブルシューティング](#-トラブルシューティング-troubleshooting)
8. [デザインのカスタマイズ](#デザインのカスタマイズ-design-customization)
9. [免責事項・お問い合わせ](#免責事項お問い合わせについて)

## ⚠️ 配布・利用規定 (Distribution & License)
本プログラムは **KENT WEB** 様の「Patio」を改造したものです。
利用に際しては、以下のKENT WEB様の規定に従ってください。

- **プログラム利用規定**: [http://www.kent-web.com/pubc/kitei.html](http://www.kent-web.com/pubc/kitei.html)
- **再配布規定**: [https://www.kent-web.com/pubc/saihaifu.html](https://www.kent-web.com/pubc/saihaifu.html)

※本改造版は商用利用を目的としていません。
※著作権表示はコード内に保持されています。

### 二次配布（再配布）の禁止
本プログラム（改造版）の著作権は一部改造者（配布者）に帰属しますが、オリジナルの著作権はKENT WEB様にあります。
本改造版の**無断での二次配布（再配布）は固くお断りいたします。**
ご紹介いただく場合は、本GitHubリポジトリへのリンクをお願いいたします。

### 禁止事項
以下の用途での利用は禁止いたします。
* 公序良俗に反するサイトでの利用
* 違法性を帯びるコンテンツを取り扱うサイトでの利用
* スパム投稿や荒らし行為を目的とした利用
* 著作権表示（Copyright）を削除しての利用

---

## 主な機能 (v3.0)

### 1. 💌 往復書簡に特化したUI
- **1対1の会話が見やすい**: 相手との会話のみを抽出する「タイムライン表示」を搭載。
- **文通デスク機能**: 複数人への返信を溜めておき、一括で送信する機能を標準搭載。
- **スマホ完全対応**: 2025/2026年のWeb標準（Flexbox/Grid）でデザインを刷新。

### 2. 🔔 通知タスク機能 (v3.0 New!)
- **常駐型通知**: ブラウザを開いておくと、自分宛ての手紙を検知して通知します。
- **ToDoリスト化**: 未読の手紙は「タスク」として画面に残り続け、「完了」ボタンを押すまで消えません。返信忘れを強力に防止します。
- **オフライン永続化**: ブラウザを閉じても未読リストは維持されます。

### 3. 📦 メモリーボックス (ログ保存)
- **思い出をアルバムに**: ボタン一つで過去のログをHTML形式でダウンロード。
- **ローカル閲覧**: ダウンロードしたファイルは、ネットがない環境でもチャット風ビューアで閲覧可能です。

### 4. 🎨 テーマ切り替え
- **Pop / Chaos**: お洒落でビビッドなモダンデザイン。
- **Gloomy**: ダークで落ち着いた配色。管理画面から切り替え可能。
- **Simple**: ビジネスライクで読みやすい配色。

## 📸 スクリーンショット (Screenshots)

### トップ画面 (Main Screen)
![トップ画面](docs/images/screen_top.png)

### 記事詳細・レス画面 (Thread View)
![直接返信フォーム](docs/images/screen_floating_form.png)
*タイムラインを見ながら返信できる「直接返信（ミニウィンドウ）」*

### 文通デスク (Correspondesk)
![デスクへの登録](docs/images/screen_desk_entry.png)
*1. 返事を書きたい手紙を見つけたら「デスクに置く」ボタンをクリック*

![タイムラインを見ながら執筆](docs/images/screen_desk_timeline.png)
*2. 相手との会話ライン（タイムライン）を見ながら、じっくり返事を書くことができます*

![デスクでの一括編集](docs/images/screen_desk_panel.png)
*3. 画面下部にストックされた返信を一括で書いて、最後にまとめて送信！*

### 通知機能 (Notifications)
![通知設定：名前入力](docs/images/screen_notify_setup_name.png)
*1. 画面右上の「通知設定」から監視したい名前を入力*

![通知設定：確認](docs/images/screen_notify_setup_confirm.png)
*2. OKを押して監視をスタート*

![通知：受信時](docs/images/screen_notify_popup.png)
*3. 手紙が届くと、画面右上のトーストとOSの通知でお知らせします（ブラウザを閉じていてもOK！）*

### メモリーボックス (Memory Box / Log Saving)
![思い出を保存ボタン](docs/images/screen_memory_action.png)
*1. 各スレッド上部の「思い出を保存」ボタンから、いつでもログをダウンロード*

![チャット風ビューア：全体](docs/images/screen_memory_viewer_all.png)
*2. ダウンロードしたHTMLは、ネットがなくても見れる専用ビューア付き！*

![チャット風ビューア：個別](docs/images/screen_memory_viewer_detail_1.png)
![チャット風ビューア：個別2](docs/images/screen_memory_viewer_detail_2.png)
*3. 相手ごとにフィルタリングして思い出を振り返ることができます*

### デザインテーマ (Themes)
![デザイン：Gloomy](docs/images/screen_theme_gloomy.png)
*Gloomy: ダークで落ち着いた配色*

![デザイン：Simple](docs/images/screen_theme_simple.png)
*Simple: ビジネスライクで読みやすい配色*

### 使い方・マニュアル (Manual & Rules)
![使い方・マニュアル](docs/images/screen_manual_rule.png)
*「使い方」ページには、タイムラインや通知を正しく機能させるための重要なルール（名前の統一など）が記載されています。必ずご一読ください。*

## 📥 ダウンロード方法 (Download)

GitHubに不慣れな方は、以下の手順でファイルを一括ダウンロードできます。

1. ページ右上にある緑色の **[<> Code]** ボタンをクリックします。
2. 出てきたメニューの一番下にある **[Download ZIP]** をクリックします。
3. `letterBBS-modernized-main.zip` (または類似の名前) というファイルがダウンロードされます。
4. このZIPファイルを解凍します。
5. 解凍したフォルダの中に `patio` フォルダがあり、**さらにその中に `patio` フォルダがあります。**
6. **この「内側の `patio` フォルダ」のみが必要なファイル群です。**

## ✅ 動作確認済み環境 (Tested Environment)

本プログラムは以下の環境で動作確認を行っています。

*   **サーバー**: さくらのレンタルサーバ（スタンダードプラン）
*   **Perlバージョン**: 5.32.1 (FreeBSD)
*   **文字コード**: UTF-8

※ さくらのスタンダートプランでは標準で動作しますが、`.cgi` ファイルのパーミッションは `705` または `755` である必要があります。

## 設置方法 (Installation)

1. **Perl環境の確認**: サーバーでPerlが動作することを確認してください。
2. **アップロード**: 上記の **「内側の `patio` フォルダ」** の中身を、サーバーの任意の場所にアップロードします。（例: `patio` という名前でアップロード）
   ※ `.git` や `docs` などの他のファイルはアップロード不要です。
3. **パーミッション設定**:
   - `patio.cgi`: `705/755` (実行権限)
   - `admin.cgi`: `705/755` (実行権限)
   - `data/` (ディレクトリ): `707/777` (書き込み権限)
   - `data/*.log`: `606/666` (書き込み権限)

## 更新履歴
- **v3.0**: 通知タスク機能の実装、Stableリリース。
- **v2.0**: デザイン刷新、文通デスク機能実装。

---
Base Script: Patio v5.12 (c) KENT WEB
Modified by: Sanada (Advanced Agentic AI Team)

## プログラムの設定及び設置
全体のディレクトリ構成とファイル位置の設置例は以下のとおりです。（かっこ内はパーミッションの設定値）

### ディレクトリ構成例

```text
public_html (ホームディレクトリ)
      |
      +-- patio / patio.cgi     [705] ... 掲示板本体
            |     admin.cgi     [705] ... 管理画面
            |     regist.cgi    [705]
            |     captcha.cgi   [705]
            |     check.cgi     [705] ... チェック後はファイル削除
            |     init.cgi      [604]
            |
            +-- lib / *.*
            |
            +-- data / index1.log  [606]
            |    |     index2.log  [606]
            |    |     memdata.cgi [606]
            |    |     pass.dat    [606]
            |    |
            |    +-- log [707] /
            |    +-- ses [707] /
            |    +-- pwd [707] /
            |
            +-- upl [707] /
            |
            +-- cmn / *.*
```

### 設定ファイルの修正 (`init.cgi`)

`init.cgi` をエディタで開いて以下の箇所を環境に合わせて修正してください。

```perl
$cf{authkey} = 0;
# （会員アクセス制限を行う場合には 1 とします）

# 【重要】管理パスワードの初期設定
# 設置直後の初期アカウントは以下の通りです。
# -----------------------------
# ログインID: admin
# パスワード: password
# -----------------------------
# ※ セキュリティのため、設置後は必ず管理画面からパスワードを変更してください。

![管理パスワード設定](docs/images/initial_setup.png)

$cf{authtime} = 60;
# （会員アクセス制限を行う場合のログイン後の有効時間を分単位で指定します）

$cf{image_upl} = 0;
# （親記事の画像アップを許可する場合は「1」を、許可しない場合は「0」とします）

$cf{title} = "私書箱";
# （掲示板のタイトルを記述します）

$cf{i_max} = 1000;
# （現行ログとして保持するスレッド数の最大値です。これを超えると、古いスレッドから過去ログへ移行します）

$cf{p_max} = 3000;
# （過去ログとして保持するスレッド数の最大値です。これを超えると、古い順に自動削除します）

$cf{pg_max} = 10;
# （スレッド内の返信記事で、1ページ当りに表示される記事数です）

$cf{m_max} = 1000;
# （１スレッド当りの最大返信数です。これを超えるとスレッドは終了し、過去ログへ移行します）

$cf{pgmax_now} = 50;
# （初期メニューでのスレッド最大表示数です）

$cf{pgmax_past} = 100;
# （過去ログメニューでのスレッド最大表示数です）

$cf{upldir} = './upl';
$cf{uplurl} = './upl';
# （画像ディレクトリのパスを、上から順にサーバパス、URLパスの順で指定します。URLパスは http://から記述してもかまいません）

$cf{max_failpass} = 10;
# （管理パスワードの最大間違い制限を指定します。この回数以上になるとログインがロックされます）
```

### CGIファイルのPerlパス修正

以下のファイルをエディタで開き、1行目のPerlパスをプロバイダの指定に合わせて修正してください。

- `patio.cgi`
- `regist.cgi`
- `check.cgi`
- `captcha.cgi`
- `admin.cgi`

```perl
#!/usr/local/bin/perl
# （例：プロバイダで定められたPerlへのパス）
```

### パーミッション設定

ファイルを修正後、所定のディレクトリへFTP転送し、以下の通りアクセス権（パーミッション）を設定してください。

| ファイル名 | 一般サーバ | suEXEC / CGIWrap | 転送モード |
| :--- | :---: | :---: | :---: |
| patio.cgi<br>regist.cgi<br>check.cgi<br>admin.cgi<br>captcha.cgi | 755 or 705 | 701 or 700 | アスキー |
| index1.log<br>index2.log<br>memdata.cgi | 666 or 606 | 600 | アスキー |
| init.cgi | 644 or 604 | 600 | アスキー |
| uplディレクトリ | 777 or 707 | 755 or 705 | - |
| data/logディレクトリ<br>data/sesディレクトリ | 777 or 707 | 701 or 700 | - |
| lib/*.*<br>style.css<br>tmpl/*.html | - | - | アスキー |
| icon/*.gif<br>lib/bin/*.png<br>lib/bin/*.ttf | - | - | バイナリー |

※ 設置作業完了後、「チェックモード」(`check.cgi`) で動作チェックを行ってください。動作チェック後は、セキュリティのため `check.cgi` を削除してください。

## 🔧 トラブルシューティング (Troubleshooting)

**Q. 設置しても「Internal Server Error (500)」が出ます**
A. 以下の点を確認してください。
*   **パーミッション（属性）**: CGIファイルは `705` または `755` に設定されていますか？
*   **Perlのパス**: ファイルの1行目 (`#!/usr/local/bin/perl` 等) はサーバーの仕様と合っていますか？
*   **FTP転送モード**: CGIファイルは必ず「アスキー（テキスト）モード」で転送する必要があります。「バイナリモード」で転送すると動きません。
*   **改行コード**: ファイルの改行コードが「LF」になっているか確認してください。

**Q. 投稿しても記事が反映されません / ログファイルが壊れます**
A. `data/` ディレクトリ内のログファイル (`*.log`) およびディレクトリ自体のパーミッションを確認してください。書き込み権限 (`606/666` や `707/777`) が必要です。

## デザインのカスタマイズ (Design Customization)

本プログラムの見た目は、`cmn/style.css` を編集することで自由に変更可能です。特にプログラム本体（CGI）を触ることなく、色やフォントを簡単に変えられるように設計されています。

### 1. 基本カラーの変更

`cmn/style.css` の冒頭にある `:root` 定義を編集することで、サイト全体の配色を一括で変更できます。

```css
:root {
    /* 背景色 */
    --color-bg: #dfe4ea;
    
    /* 記事やフォームの背景色 */
    --color-card: #ffffff;
    
    /* 文字色 */
    --color-text: #2f3542;
    
    /* メインカラー（ヘッダー、強調、見出しなど） */
    --color-primary: #ff4757;
    
    /* セカンダリカラー（ボタン、アクセント線など） */
    --color-secondary: #2ed573;
    
    /* アクセントカラー（フォーカス時、バッジなど） */
    --color-accent: #ffa502;
    
    /* 枠線の色 */
    --color-border: #a4b0be;
}
```

これらのカラーコード（`#`で始まる6桁の英数字）をお好みの色に変更してください。

### 2. フォントの変更

デフォルトではGoogle Fontsの「Mochiy Pop One（見出し）」と「Zen Maru Gothic（本文）」を使用しています。

**手順:**
1. [Google Fonts](https://fonts.google.com/) から使用したい日本語フォントを探します。
2. 選択したフォントの埋め込みコード（`@import` 形式）をコピーします。
3. `cmn/style.css` の3-4行目を書き換えます。

```css
/* Google Fonts の読み込み */
@import url('https://fonts.googleapis.com/css2?family=あなたの選んだフォント&display=swap');

:root {
    /* 見出し用フォント */
    --font-heading: 'あなたの選んだフォント', sans-serif;
    
    /* 本文用フォント */
    --font-body: 'あなたの選んだフォント', sans-serif;
    /* ... */
}
```

### 3. 文字サイズの変更

全体の基本的な文字サイズを変更したい場合は、`body` セレクタの設定を調整または追記してください。

```css
body {
    /* ... */
    
    /* 基準となるフォントサイズ (デフォルトはブラウザ標準=16px相当) */
    font-size: 16px; 
}
```

- 小さくしたい場合: `14px` や `0.9rem`
- 大きくしたい場合: `18px` や `1.1rem`

※ 各パーツ（見出しやボタン）は、この基準サイズに対する比率（rem単位）で設定されているため、ここを変えるだけで全体サイズが連動して変わります。

### 4. テンプレートの選択

管理画面（`admin.cgi`）の「デザイン設定」から、プリセットされた3つのテーマをボタン一つで切り替えることができます。

![デザイン設定画面](docs/images/design_choice.png)

- **標準 (Pop/Chaotic)**: デフォルトの明るくポップなデザイン
- **Gloomy (Dark/Muted)**: 暗色系の落ち着いたデザイン
- **Simple (Neutral/Business)**: 配色を抑えたシンプルなデザイン

### 5. デザインテーマごとのカスタマイズ

現在選択しているテーマに合わせて、編集するCSSファイルが異なります。
基本的なカスタマイズ方法は上記の「1. 基本カラーの変更」と同じですが、対象となるファイルが以下のようになります。

| テーマ名 (Theme) | 編集するファイル | 特徴 |
| :--- | :--- | :--- |
| **標準 (Pop/Chaotic)** | `cmn/style.css` | デフォルトの派手なデザイン。 |
| **Gloomy (Dark/Muted)** | `cmn/style_gloomy.css` | 黒背景を基調としたサイトの場合、こちらを編集してください。 |
| **Simple (Neutral/Business)** | `cmn/style_simple.css` | 白背景のシンプルなサイトの場合、こちらを編集してください。 |

※ `style_gloomy.css` や `style_simple.css` の中にも、冒頭に `:root` 定義がありますので、そこを書き換えるだけで色が変更できます。

---

## 免責事項・お問い合わせについて

本改造プログラムは、AIエージェント「AntiGravity」を利用したバイブコーディング（Vibe Coding）により作成されました。
そのため、プログラム改造者（配布者）自身のプログラミング知識は限定的であり、技術的な詳細については把握していない部分がございます。

誠に恐れ入りますが、**個別の改造依頼や、設置・動作に関する技術的なご質問等は受け付けておりません。**
あらかじめご了承の上、ご利用いただけますようお願い申し上げます。

また、当サイトのプログラムを利用した事によるいかなる損害も作者は一切の責任を負いません。
最低限の動作確認は実施済みですが、必ず設置者も各種プログラムの動作確認を行った上で利用をお願いいたします。
また、作成者に著しく不利益があるような状況が発生した場合は、一方的にプログラムの公開を予告なく中止させていただきます。
